var pointsCoreSystemData = {"openapi":"3.0.1","info":{"title":"积分系统后端 API","description":"通过积分系统可以进行积分相关操作：查询积分信息、发起交易、冻结积分等。\n## 概念说明\n### 功能定义\n积分系统支持的主要操作包括: 授予(grant)、发放(offer)、交易(transact)、转账(transfer)，这些操作统称为积分流转。\n同时提供了针对上述操作的反向交易, 即取消操作: 交易取消/交易退分(refund), 取消积分发放(cancel_offer).\n除此之外接口还提供了冻结相关操作，目前冻结的概念主要是指两步的交易时冻结（我们称为transacting freeze）。\n### 积分账户角色类型说明\n积分账户角色类型: 普通账户, 运营商户, 可运营商户  - `普通账户`: 一般积分账户, 可以进行积分流转操作 - 交易(transact)、转账(transfer)、交易取消/交易退分(refund),\n  - `运营商户`: 运营积分的账户, 可以进行的积分流转操作 - 发放(offer)、取消积分发放(cancel_offer)\n\n### 外部流水号\n外部流水号 `out_sn`（sn 是 serial number 的简称）存在于各种积分流转的接口，每一笔积分流转都必须对应一个外部流水号。\n之所以称为外部，是因为这是由调用方在积分流转接口输入的参数。调用方需要认真规划外部流水号的规则和生成时机，确保给每次积分流转的调用需求分配一个**本调用方**全局唯一的流水号，作为积分系统的外部流水号。 由于不同的流转操作类型的外部流水号都要求彼此间相互唯一、不能重复（例如：某一调用方每笔发放的外部流水号必须是唯一的，每笔交易的外部流水号也要是唯一的），所以这需要调用方进行严格的标识或分段规划。\n### 来源和备注\n积分流转的接口都具有两个特别的字段，主要用来作统计和追溯，并不参与实际的处理逻辑：\n* `source`: 外部来源。用来标识调用者调用场景等。\n* `remark`: 外部备注信息，可以是 json 格式。其格式具体定义由 `source` 确定。这个信息应包含用于追溯的调用方数据，其完备性应该能够支持完整的操作链追溯。如果想实现积分交易自定义交易描述，此参数值必须是 json 格式的字符串，且里面一级参数名称必须为 `transaction_title`，值为交易明细说明，示例：\n``` \"{\\\"transaction_title\\\": \\\"生日送积分活动\\\"}\" ```\n\n## API 规范说明\n### 请求格式规范\n#### 请求 HTTP Header 全局说明\n  一般的请求此参数均在header中下列参数都是必填项，其中`Authorization`为需要登录验证的接口必填。\n\n  | 参数名称  | 是否必须 | 参数类型 | 参数描述 |\n  | ------------ | -------- | -------- | ----------------------------------------|\n  | x-api-secret | 是       | string   | 通行证系统分配给接入方的 app secret\n  | Origin    | 是       | string   | 分配的域名，用来校验是否为安全配置域名 例如: http://www.google.com |\n  | Authorization | 需要登录验证的接口为必须   | string   | 参数值为登录请求接口中获取到的 `access-token`              的值，注意要在获取到的字符串最前面加上`Bearer ` |\n  | accept-language | 是　| string | 传入语言　|\n  | x-client-info\t | 是 (前端 API 无须提供) | string | 客户端信息，需要将前端收集的客户端信息json_encode后作为此参数的值 |\n  | x-forwarded-for\t| 是 (前端 API 无须提供) | string | 请求ip |\n  | Signature | 是 (后端 API 无须提供)       | string   | 一个jwt字符串，payload |\n\n#### 请求 HTTP Header 参数说明\n##### `Signature` 头部说明\n- `Signature` jwt 加密秘钥\n  * 网关会分配给接入方一个`secret`，这个`secret`， 由网关统一管理分发 ，此secret用来加密`Signaturre`参数jwt字符串。\n\n- `Signature` jwt payload 详情\n  * 在请求时候需要通过秘钥添加入jwt生成相应的 Signature 字符串添加到请求header中， 然后在 JWT 的 `payload` 字段中添加如下终端信息参数，此参数每次接口请求时候都必须带上，可以访问 jwt加密&验证。\n\n  | 参数名称    | 是否必须 | 参数类型 | 参数描述 |\n  | --------- | -------- | ------ | ------  |\n  | iss       | 是       | string   | 此参数为固定值 member-account-system-kit  |\n  | exp       | 是       | int      | 过期时间，为当前uninx时间戳+7200秒，例：1545726078  |\n  | alg       | 是       | string   | 加密方式 ，固定值：HS256  |\n\n\n\n##### `x-client-info` 头部说明\n  `x-client-info` 头部的值是 json 序列化后的字符串\n\n  | 参数名称                | 是否必须 | 参数类型 | 参数描述 |\n  | ---------------- | -------- | -------- | -----------|\n  | device_type      | 是       | string   | 目前只接受`app.ios`,`app.android`,`web.pc`,`web.h5`,`3rd.wechat`,`3rd.qq` |\n  | device_id        | 是       | string   | 设备的唯一标示 |\n  | device_brand     | 是       | string   | app:手机品牌 pc:pc品牌,获取不到默认值`pc`  |\n  | app_channel      | 否       | string   | 渠道 |\n  | app_version      | app必填  | string   | app版本号 |\n  | package_name     | app必填   | string   | 包名 |\n  | package_type     | app必填   | string   | debug / alpha / beta / release |\n  | system_version   | 是       | string      | 手机/pc 操作系统版本  |\n  | system_language  | 是       | string   | 系统语言  |\n  | browser_version  | 非app必填 | string   | 浏览器版本,如果是三方软件(例如微信)内嵌浏览器，则为三方软件版本 |\n  | network_type     | app必填  | string   | 当前网络类型:Wi-Fi 5G / 4G / 3G / 2G  |\n  | referer_key      | 否       | string   | 调用来源唯一标示  |\n  | idfa             | 否       | string   | iOS平台广告标示符 |\n\n  - **app必填**：客户端调用的情况下必填，当device_type为app.*客户端调用的情况下必填\n  - **非app必填**：非客户端调用情况必填\n\n### 返回格式说明\n#### HTTP Status\nhttp 的状态码只返回 200 和 500，除内部错误为500外，其它均为200，业务错误码通过 HTTP Body 中的 `code` 标识\n#### HTTP Body\n返回数据统一为 `json` 编码, 格式统一为\n```js\n{   \"code\": 0,\n   \"message\": \"success\",\n   \"data\": {}\n}\n```\n- code: 业务错误码标识，只有为 0 表示成功, 其他值表示失败或错误\n- message: 简要说明，如code为0时值为 `success`\n- data: 接口返回具体的数据，部分接口 `data` 为空\n### 错误码说明\n  | 错误码 | 说明 |\n  | ------ | ------|\n  | 401   | 请求未授权 |\n  | 404   | 请求地址没找到 |\n  | 405   | 请求方式错误 |\n  | 500   | 系统错误 |\n  | 501   | 参数错误 |\n  | 502   | 内部错误 |\n  | 41001 | 权限错误。示例：如果只有公开接口的权限，但是调用内部接口或者私有接口，就会返回这个错误码。|\n  | 41003 | 未被授权的交易。示例：运营商只能发分，但是如果有用户给运营商发分，就会返回这个错误码。|\n  | 41004 | 未被授权交易动作。说明：如果一个账户被冻结（不能收分）之后还给此用户发分，就会返回这个错误码。|\n  | 42001 | 子账户积分余额不足。 |\n  | 42002 | 子账户积分余额低于预警值。|\n  | 42003 | 用户不存在。|\n  | 42004 | 用户没有绑定手机号码。|\n  | 42005 | 积分参数验证失败。说明：如在不支持小数的情况，传入小数积分。|\n  | 43001 | 数据不存在。|\n  | 46002 | 订单取消金额不足,说明:如果一次发分100,然后要取消200分的时候,就会报此错误 |\n  | 45001 | 外部流水号已存在。|\n  | 51000 | 调用第三方失败。|\n  | 51001 | 调用第三方请求失败。|\n\n\n\n### 积分上报事件接入规范\n#### 事件格式\n- 使用json数据格式\n#### 必填参数\n- account_id  事件上报用户id,事件实际发分或者扣分都只以这个id的用户为准 - event_content  事件上报的业务参数内容,租户自定义内容,用于必须为json格式 - app_key  事件上报租户的应用app_key - event_key  事件编码 - happened_ts  事件发生时间,值为毫秒时间蹉 - created_ts  事件上报时间,值为毫秒时间蹉\n> 上报方的业务参数内容都应该放到event_content里面,在创建事件的时候填的参数也只能在event_content中获取 比如创建事件中事件参数填写了交易金额:amount,规则匹配的时候会去寻找event_content中的amount字段来做参数匹配\n> 如果在event_content顶层定义publisher_info,那么在返回事件结果通知的时候,publisher_info的内容会在事件中被原样返回\n> 如果发放项那边填的是时间参数,在匹配规则时,系统会把参数转成毫秒时间戳格式,所以如果调用方需要匹配时间类型的参数,请上报事件的时也讲时间参数转成毫秒时间戳格式\n#### 事件示例\n```\n{    \"event_content\": {\n        \"id\": 1,\n        \"amount\": 100,\n        \"account_id\": 16421,\n        \"payment_id\": 4,\n        \"transaction_status\": 1,\n        \"merchant_transaction_id\": 11,\n        \"payment_method\": \"alipay\",\n        \"publisher_info\":\"publisher_info\",\n        \"PaymentMerchant\": {\n            \"wallet_merchant_id\": 1,\n            \"partner_merchant_id\": 1,\n            \"name\": \"钱包支付\"\n        }\n    },\n    \"app_key\": \"ahahdah11212\",\n    \"event_key\": \"498099053\",\n    \"account_id\": 180,\n    \"id\": 11,\n    \"happened_ts\": 1571307067000,\n    \"created_ts\": 1571307067000\n}\n```\n业务方上报了积分事件之后,如果上报事件能匹配上发放项的规则并且参数检测通过后,积分系统会返回一个上报事件结果通知.结果通知分为发分成功和发分失败两种\n- 上报事件的exchange是 `tennant-租户id`\n上报事件结果通知使用protobuf的格式发送,对应的protobuf包地址[protobuf地址](http://git.tech.nanhaicorp.com.cn/dd01-member/member-event-proto/blob/development/proto/dd01/points/points_offer.proto)\n### 积分事件通知事件包含:\n#### 发分成功事件\n- 发分成功事件对应的routing_key是 `dd01.protobuf.points.PointsOffed`\n#### 发分失败事件\n  - 积分系统异常\n    - code:`401`\n  - 发分账号余额达到了预警值\n    - code:`501`\n  - 发分账号余额不足\n    - code:`701`\n  - 收分账号没绑定手机\n    - code:`801`\n  - 发分账号没权限发分\n    - code:`901`\n  - 收分账号不存在\n    - code:`1001`\n  - 发放项暂停\n    - code:`1101`\n  - 发分达到封顶值\n    - code:`1201`\n  - 发分账号冻结\n    - code:`1301`\n\n- 发分成功事件对应的routing_key是 `dd01.protobuf.points.PointsOfferFailed`","version":"1.0.1"},"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"},{"url":"http://dist-sz.kpmember.cn/points-core-system-kit--租户Key/api/v1","description":"for Internal"},{"url":"http://dist-sz.kpmember.cn/points-core-system-kit--租户Key","description":"Only for health check"}],"components":{"parameters":{"pageParam":{"name":"page","in":"query","description":"分页参数，当前页码","required":false,"schema":{"type":"integer","format":"int32","minimum":1,"default":1}},"pageSizeParam":{"name":"size","in":"query","description":"分页参数，每页显示的数据数量。范围 1 ~ 100, 默认 20。","required":false,"schema":{"type":"integer","format":"int32","minimum":1,"maximum":100,"default":20}},"accountIdPathParam":{"name":"account_id","in":"path","description":"账户的 account_id","required":true,"schema":{"type":"integer","format":"int64"}},"startTimeParam":{"name":"start_time","in":"query","description":"起始时间，UTC+8时区。示例：2019-07-01 15:21:59","required":false,"schema":{"type":"string"}},"endTimeParam":{"name":"end_time","in":"query","description":"结束时间，UTC+8时区。示例：2019-07-03 15:21:59","required":false,"schema":{"type":"string"}},"roleTypeParam":{"name":"role_type","in":"query","description":"角色类型。目前定义的类型有：member/merchant/operator/operable_merchant","required":false,"schema":{"type":"string","default":"member","enum":["member","merchant","operator","operable_merchant"]},"example":"member"},"sortParam":{"name":"sort","in":"query","description":"指定排序方式，默认按时间和 ID 倒序。\n* \"-created_at\": 按 created_at 倒序\n* \"created_at\": 按 created_at 正序\n* \"-id\": 按 id 倒叙\n* \"id\": 按 id 正叙\n","required":false,"schema":{"type":"string"}}},"responses":{"Standard401ErrorResponse":{"description":"Unauthorized","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"Standard4XXErrorResponse":{"description":"Bad Request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}},"schemas":{"AccountBalance":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":3884},"account_id":{"type":"integer","description":"账户的 account_id","example":4294968997},"balance_amount":{"type":"integer","description":"可用积分（总积分减去总冻结积分）数量","example":888},"freeze_amount":{"type":"integer","description":"不可用积分（总冻结积分）数量","example":1288},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"PartnerRoleType":{"type":"string","description":"账户角色\n* merchant 商户角色\n* operator 运营角色\n* operable_merchant 可运营商户角色\n","enum":["merchant","operator","operable_merchant"],"default":"merchant","example":"merchant"},"AllRoleType":{"type":"string","description":"账户角色\n* member 普通角色\n* merchant 商户角色\n* operator 运营角色\n* operable_merchant 可运营商户角色","enum":["member","merchant","operator","operable_merchant"],"default":"merchant","example":"merchant"},"AccountType":{"description":"账户类型\n* offer_sub_account 发放子账户\n* income_sub_account 收分子账户\n* transfer_sub_account 交易子账户\n","type":"string","enum":["offer_sub_account","income_sub_account","transfer_sub_account"],"example":"transfer_sub_account"},"AppConfigInfo":{"type":"object","properties":{"app_key":{"type":"string","description":"app key","example":"e16045a809b3da6411"},"freeze":{"type":"string","description":"冻结结果查询配置","example":{"action_query_api_url":"http://xxx/api/v1/transaction/status","action_query_after":86400,"timeout":604800,"app_secret":"3434ui3ohjekhjhjerioi"}},"default_language":{"type":"string","description":"默认语言","example":"zh-Hant-HK"},"transaction_title_template":{"type":"string","description":"交易明细配置信息","example":{"template_key":{"from":{"en":"display english transaction description","zh-Hans-CN":"展示积分明细描述, 使用简体中文","zh-Hant-HK":"展示積分明細描述, 使用繁體中文"}},"hk01.protobuf.wallet.payment.PaymentSuccess":{"from":{"en":"Payment success! You payed {amount} points to {target_nickname}","zh-Hans-CN":"交易成功, 你向 {target_nickname} 支付了 {amount} 个积分.","zh-Hant-HK":"交易成功, 你向 {target_nickname} 支付了 {amount} 個積分."},"to":{"en":"Payment success! You received {amount} points from {from_nickname}","zh-Hans-CN":"交易成功! 你从 {target_nickname} 获得 {amount} 个积分.","zh-Hant-HK":"交易成功! 你從 {target_nickname} 獲得 {amount} 個積分."}},"self_defined_template_key_1":{"from":{"en":"Thank you! You donate {amount} points for this campaign.","zh-Hans-CN":"感谢你, 你为这个活动捐赠了 {amount} 个积分.","zh-Hant-HK":"感謝你, 你為這個活動捐贈了 {amount} 個積分."}},"self_defined_template_key_2":{"to":{"en":"Congratulations! You earn {amount} points from this campaign.","zh-Hans-CN":"恭喜你! 参加活动获取了 {amount} 个积分.","zh-Hant-HK":"恭喜你! 參加活動獲取了 {amount} 個積分."}}}}}},"AppFreezeActionQueryApi":{"type":"object","properties":{"out_sn":{"type":"string","description":"外部流水号","example":"test1212232334234"},"action":{"required":true,"type":"string","description":"需要的操作，只能为转交易（commit_transaction）、取消冻结（cancel）、保持现状（hold）","example":"commit_transaction"},"next_query_second":{"type":"integer","description":"下次查询时间，单位是秒。当返回 action 为 hold 时，会根据当前时间 + next_query_second 秒之后执行下次再次请求接口（最多再执行4次查询）。如果此项没填或者值小于60秒时，按照 60 秒操作。","example":120}}},"AppCreateDelete":{"type":"object","properties":{"app_key":{"type":"string","description":"AppKey","example":"sdsdskdksajdkjkjwidjwj","required":true}},"required":["app_key"]},"AppInfo":{"allOf":[{"$ref":"#/components/schemas/AppCreateDelete"},{"type":"object","properties":{"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}}]},"ExpireRecord":{"type":"object"},"OutSn":{"type":"string","description":"外部流水号","example":3939948484},"RawOutSn":{"type":"string","description":"x-api-key#外部流水号","example":"jdskjdklsajderieorieoi#3939948484"},"ReverseSn":{"type":"string","description":"退分外部流水号","example":3939948484},"Remark":{"description":"外部系统备注信息","type":"string","example":"{\"transaction_title\": \"测试\"}"},"Source":{"description":"外部来源","type":"string","example":"order"},"FreezeRecord":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":10001},"from_account_id":{"type":"integer","description":"发起人账号的 account_id","example":4294976823},"to_account_id":{"type":"integer","description":"收分商家账号的 account_id","example":4294971063},"freeze_amount":{"type":"integer","description":"冻结的积分数量","example":2018},"cancelled_at":{"type":"string","description":"解冻时间","example":"2018-08-12T15:19:21+08:00"},"transacted_at":{"type":"string","description":"生成交易时间","example":"2018-08-12T15:19:21+08:00"},"out_sn":{"$ref":"#/components/schemas/OutSn"},"remark":{"$ref":"#/components/schemas/Remark"},"source":{"$ref":"#/components/schemas/Source"},"status":{"$ref":"#/components/schemas/FreezeRecordStatus"},"reason":{"type":"string","description":"原因，解冻是填写","example":"订单未付款"},"transaction_record_id":{"type":"string","description":"交易记录的ID","example":8866},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"GrantRecord":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":12883},"account_id":{"type":"integer","description":"用户的 account_id","example":4294976823},"grant_amount":{"type":"integer","description":"发放的积分数量","example":288888},"balance_amount":{"type":"integer","description":"可用余额","example":8886},"clear_amount":{"type":"integer","description":"到期清除的积分数量","example":8886},"out_sn":{"$ref":"#/components/schemas/OutSn"},"raw_out_sn":{"$ref":"#/components/schemas/RawOutSn"},"remark":{"$ref":"#/components/schemas/Remark"},"source":{"$ref":"#/components/schemas/Source"},"status":{"$ref":"#/components/schemas/GrantRecordStatus"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"IncomeAccount":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":23452},"account_id":{"type":"integer","description":"账户的 account_id","example":4294976823},"balance_amount":{"type":"integer","description":"账户余额","example":88888},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"PointsAccount":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":3848},"account_id":{"type":"integer","description":"账户的 account_id","example":4294976823},"balance_amount":{"type":"integer"},"freeze_amount":{"type":"integer"},"status":{"type":"string","enum":["invalid","valid"]},"type":{"type":"integer"},"created_at":{"type":"string"},"updated_at":{"type":"string"}}},"PointsAccountInfo":{"type":"object","properties":{"account_id":{"type":"integer","description":"记录ID","example":4294976823},"status":{"$ref":"#/components/schemas/PointsAccountStatus"},"role_type":{"type":"string","description":"账户的类型 merchant（商家账户）、operator（运营账户）或operable_merchant（可运营商家账户），member（普通账户）","example":"operator"},"balance_amount":{"type":"integer","description":"积分余额（含发放子账户和收分子账户）","example":5000},"freeze_amount":{"type":"integer","description":"冻结积分","example":300},"offer_balance_amount":{"type":"integer","description":"发放子账户积分余额","example":5000},"income_balance_amount":{"type":"integer","description":"收分子账户积分余额","example":5000},"username":{"type":"string","description":"账户名称","example":"test"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"},"recently_expire_at":{"type":"date","description":"最近过期时间（只有普通会员才有此值，其他类型返回\"\"）","example":"2018-08-12T23:59:59+08:00"},"recently_expire_amount":{"type":"integer","description":"最近即将过期分数（只有普通会员才有此值，其他类型返回0）","example":1}}},"PointsAccountBase":{"type":"object","properties":{"account_id":{"type":"integer","description":"记录ID","example":4294976823},"balance_amount":{"type":"integer","description":"积分余额（含发放子账户和收分子账户）","example":5000},"status":{"type":"string","enum":["invalid","valid"],"description":"状态","example":"invalid"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"PointsAccountBalanceList":{"type":"array","items":{"$ref":"#/components/schemas/PointsAccountInfo"}},"PointsFragmentRecord":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":1},"account_id":{"type":"integer","description":"用户的 account_id","example":4294976823},"balance_amount":{"type":"integer","description":"可用积分（不包括冻结积分）","example":5000},"freeze_amount":{"type":"integer","description":"冻结积分","example":5000},"expired_at":{"$ref":"#/components/schemas/ExpiredAt"}}},"PointsFragmentRecordArray":{"type":"array","items":{"$ref":"#/components/schemas/PointsFragmentRecord"}},"PointsRecord":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":1},"account_id":{"type":"integer","description":"用户的 account_id","example":4294976823},"role_type":{"type":"string","description":"账户的类型 merchant（商家账户）、operator（运营账户）或operable_merchant（可运营商家账户），member（普通账户）","example":"operator"},"before_balance_amount":{"type":"integer","description":"变更前积分余额","example":20000},"amount":{"type":"integer","description":"变更积分数量","example":5000},"after_balance_amount":{"type":"integer","description":"变更后积分余额","example":15000},"title":{"type":"string","description":"积分变动描述","example":"签到获取 5000 积分"},"record":{"oneOf":[{"$ref":"#/components/schemas/ExpireRecord"},{"$ref":"#/components/schemas/GrantRecord"},{"$ref":"#/components/schemas/TransactionRecord"},{"$ref":"#/components/schemas/ReverseTransactionRecord"}],"description":"记录明细","example":{"id":33788,"from_account_id":1000800,"to_account_id":230,"from_account_role_type":"operable_merchant","to_account_role_type":"member","transaction_type":"offer","source":"policy-offer","out_sn":"31d4ab35-b1ba-4abc-a985-1714ac311c2e","raw_out_sn":"wueiwurieurkjfhdjskhfjdkshfiue#33431d4ab35-b1ba-4abc-a985-1714ac311c2e","remark":"{ \"transaction_title_template\":\"template_key1\", \"offer_entry_id\":666, \"rule_matching\": [{\"offer_rule_id\":666, \"offer_rule_detail\": [{\"event_key\":\"paymentsuccess\",\"event_condition\":\"score:50-99\",\"trigger_num\":2,\"happened_num\":3,\"changed\":true}], \"offer_amount\":30}]}","created_at":"2018-08-12T15:19:21+08:00","updated_at":"2018-08-12T15:19:21+08:00"}},"record_type":{"$ref":"#/components/schemas/PointsRecordType"},"direction":{"$ref":"#/components/schemas/DirectionType"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"PointsRecordArray":{"type":"array","items":{"$ref":"#/components/schemas/PointsRecord"}},"FreezeRecordStatus":{"type":"string","enum":["freezing","cancelled","transacted"],"description":"冻结状态\n* freezing 冻结中\n* cancelled 已取消\n* transacted 已转成交易\n","default":"freezing","example":"freezing"},"GrantRecordStatus":{"type":"string","description":"状态\n* invalid 未生效\n* valid 生效中\n* expired 已过期\n","enum":["invalid","valid","expired"],"example":"invalid","default":"valid"},"PointsAccountStatus":{"type":"string","description":"账户状态\n* activation 激活　\n* not_activated 未启用　\n* freeze 冻结（能进不能出）","enum":["activation","not_activated","freeze"],"default":"activation","example":"not_activated"},"PointsAccountUpdateStatus":{"type":"string","description":"账户状态\n* activation 激活　\n* freeze 冻结（能进不能出）","enum":["activation","freeze"],"example":"freeze"},"PointsRecordType":{"type":"string","description":"变更记录的类型\n- expire 过期，对应 record 为 ExpireRecord\n- grant 授予，对应 record 为 GrantRecord\n- transfer 交易，对应 record 为 TransactionRecord\n- transact 转账，对应 record 为 TransactionRecord\n- offer 发放，对应 record 为 TransactionRecord\n- cancel_offer 取消加分，对应 record 为 ReverseTransactionRecord\n- refund 取消减分，对应 record 为 ReverseTransactionRecord","enum":["expire","grant","transfer","transact","offer","cancel_offer","refund"],"example":"offer"},"DirectionType":{"type":"string","description":"交易方向\n\n- out 出账 - in 进账","enum":["out","in"],"example":"in"},"RecordType":{"type":"string","enum":["transfer","transact","offer","refund","cancel_offer","freeze","expire"],"description":"记录类型\n* transfer 积分转账\n* transact 积分交易\n* offer 积分发放\n* refund 交易退分\n* cancel_offer 取消发分\n* freeze 积分冻结\n* expire 积分过期\n"},"Error":{"type":"object","properties":{"code":{"type":"integer","description":"错误码"},"message":{"type":"string","description":"错误提示消息"},"data":{"type":"object","properties":{"points_offer_error_code":{"type":"integer","description":"points_offer错误码"},"points_offer_error_message":{"type":"string","description":"points_offer错误提示消息"}}}},"required":["code","message"],"example":{"code":40083,"message":"account_id 参数错误","data":{"points_offer_error_code":401,"points_offer_error_message":"internal error"}}},"Pagination":{"type":"object","properties":{"total":{"type":"integer","description":"数据总条数"},"per_page":{"type":"integer","description":"每页显示的数据条数"},"current_page":{"type":"integer","description":"当前页码"},"last_page":{"type":"integer","description":"最大页码"}},"example":{"total":3000,"per_page":50,"current_page":1,"last_page":60}},"ServerStatus":{"type":"object","properties":{"status":{"type":"string","description":"服务器状态"}}},"ReverseTransactionRecord":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":888842},"from_account_id":{"type":"integer","description":"发起方账户的 account_id","example":4294976823},"to_account_id":{"type":"integer","description":"目标方账户的 account_id","example":4294976823},"reverse_type":{"type":"string","enum":["cancel_offer","refund"],"description":"反向流转类型 * cancel_offer 取消发分 * refund 交易退分\n","example":"cancel_offer"},"from_account_role_type":{"$ref":"#/components/schemas/AllRoleType"},"to_account_role_type":{"$ref":"#/components/schemas/AllRoleType"},"out_sn":{"$ref":"#/components/schemas/OutSn"},"raw_out_sn":{"$ref":"#/components/schemas/RawOutSn"},"reverse_transaction_sn":{"$ref":"#/components/schemas/ReverseSn"},"remark":{"$ref":"#/components/schemas/Remark"},"source":{"$ref":"#/components/schemas/Source"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"Setting":{"type":"object","properties":{"tenant_id":{"type":"integer","example":12,"description":"租户 ID 值"}},"required":["tenant_id"]},"CreatedAt":{"type":"string","description":"记录创建时间","example":"2018-08-12T15:19:21+08:00"},"UpdatedAt":{"type":"string","description":"记录最后更新时间","example":"2018-08-12T15:19:21+08:00"},"ExpiredAt":{"type":"string","description":"过期时间","example":"2018-08-12T15:19:21+08:00"},"TransactionRecord":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":888842},"from_account_id":{"type":"integer","description":"交易发起方账户的 account_id","example":4294976823},"to_account_id":{"type":"integer","description":"交易目标方账户的 account_id","example":4294976823},"transaction_type":{"$ref":"#/components/schemas/TransactionType"},"from_account_role_type":{"$ref":"#/components/schemas/AllRoleType"},"to_account_role_type":{"$ref":"#/components/schemas/AllRoleType"},"out_sn":{"$ref":"#/components/schemas/OutSn"},"raw_out_sn":{"$ref":"#/components/schemas/RawOutSn"},"remark":{"$ref":"#/components/schemas/Remark"},"source":{"$ref":"#/components/schemas/Source"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"}}},"TransactionType":{"type":"string","enum":["transfer","transact","offer"],"description":"流转类型\n* transfer 积分转账\n* transact 积分交易\n* offer 积分发放\n"}},"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}}},"paths":{"$freeze_action_query_api":{"get":{"servers":[{"url":null,"description":null}],"security":[{"bearerAuth":[]}],"tags":["Internal 为接入方定义接口"],"summary":"冻结结果查询接口","description":"此接口为接入方实现，积分系统负责制定接口规范以及调用。\n\n根据外部订单流水号 out_sn 和冻结记录 id 查询冻结记录结果，以便进一步操作。 请求地址具体要看注册 API URL，这里只明确请求参数和返回结果。\n\n当请求此接口出现以下情况的时候，会再次进行4次查询，第2次至第5次开始时间相对第一次执行时间分别相隔30秒，60秒，120秒，240秒，如果第5次还是数据异常，就按照 `/app/set_config` 接口配置的 `timeout` 时间之后强制取消冻结。  - 接口不返回数据或者404\n  - HTTP status Code 不是200\n  - 返回值的 code 不为 0\n  - 返回值的中 `out_sn` 不与请求的 `out_sn` 匹配\n  - 返回值的中 `action` 不属于 `commit_transaction`、`cancel`、`hold` 中","parameters":[{"name":"out_sn","in":"query","description":"交易流水号","required":true,"schema":{"type":"string"},"example":"test122334234"},{"name":"freeze_record_id","in":"query","description":"冻结记录id","required":true,"schema":{"type":"string"},"example":129494}],"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","description":"返回值 data 里面的 result 为必须","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"成功"},"data":{"$ref":"#/components/schemas/AppFreezeActionQueryApi"}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/frontend/account/detail/me":{"get":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Frontend","Public"],"summary":"查询用户自身的账户信息（积分信息）（*需登录）","description":"用户积分详细，包括当前的可用积分和不可用积分（冻结积分）。","parameters":[{"name":"with_income_sub_account","in":"query","description":"同时返回收分子账户余额","required":false,"schema":{"type":"boolean"}},{"name":"with_offer_sub_account","in":"query","description":"同时返回发放子账户余额","required":false,"schema":{"type":"boolean"}}],"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsAccountInfo"},"extra":{"type":"object","properties":{"has_binding_phone":{"type":"boolean","description":"用户是否绑定手机号码","example":false},"income_sub_account_balance_amount":{"type":"integer","description":"收分子账户余额, 当 `with_income_sub_account` 参数为 `true` 时返回","example":0},"offer_sub_account_balance_amount":{"type":"integer","description":"发放子账户余额, 当 `with_offer_sub_account` 参数为 `true` 时返回","example":0}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/frontend/record/fragment/me":{"get":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Frontend","Public"],"summary":"查询用户自身积分有效期列表（*需登录）","description":"查询自身积分有效期列表","parameters":[{"$ref":"#/components/parameters/pageParam"},{"$ref":"#/components/parameters/pageSizeParam"}],"responses":{"200":{"description":"Successful. 以分页的方式返回用户积分有效期列表","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsFragmentRecordArray"},"extra":{"type":"object","properties":{"pagination":{"$ref":"#/components/schemas/Pagination"},"total_amount":{"type":"integer","description":"积分总计","example":6000}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/frontend/record/points/me":{"get":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Frontend","Public"],"summary":"查询用户自身的积分明细（*需登录）","description":"查询用户积分变更明细","parameters":[{"$ref":"#/components/parameters/pageParam"},{"$ref":"#/components/parameters/pageSizeParam"},{"$ref":"#/components/parameters/sortParam"},{"$ref":"#/components/parameters/startTimeParam"},{"$ref":"#/components/parameters/endTimeParam"},{"name":"direction","in":"query","description":"交易方向","required":false,"schema":{"type":"string","enum":["in 收入","out 支出"]}}],"responses":{"200":{"description":"Successful. 以分页的方式返回用户的积分变更记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsRecordArray"},"extra":{"type":"object","properties":{"pagination":{"$ref":"#/components/schemas/Pagination"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/health_check":{"get":{"servers":[{"url":"http://dist-sz.kpmember.cn/points-core-system-kit--租户Key","description":"Only for health check"}],"tags":["Public","Invisible"],"summary":"健康检查","description":"检查服务是否正常，此接口地址不需要带 API 和版本号。","responses":{"200":{"description":"Successful","content":{"text/plain":{"schema":{"type":"string","example":"ok"}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/account/detail":{"get":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"查询用户的账户信息（积分信息）","description":"根据 account_id 查询用户积分详细，包括当前的可用积分和不可用积分（冻结积分）。\n","parameters":[{"$ref":"#/components/parameters/accountIdPathParam"},{"name":"with_income_sub_account","in":"query","description":"同时返回收分子账户余额","required":false,"schema":{"type":"boolean"}},{"name":"with_offer_sub_account","in":"query","description":"同时返回发放子账户余额","required":false,"schema":{"type":"boolean"}}],"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsAccountInfo"},"extra":{"type":"object","properties":{"has_binding_phone":{"type":"boolean","description":"用户是否绑定手机号码","example":false},"income_sub_account_balance_amount":{"type":"integer","description":"收分子账户余额, 当 `with_income_sub_account` 参数为 `true` 时返回","example":0},"offer_sub_account_balance_amount":{"type":"integer","description":"发放子账户余额, 当 `with_offer_sub_account` 参数为 `true` 时返回","example":0}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/app/get_config":{"get":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"获取第三方应用设置配置信息","description":"业务方根据 key 查询对应的配置信息。\n","parameters":[{"name":"app_key","in":"query","description":"账号系统颁发的 appKey","required":true,"schema":{"type":"string","example":"34343434324sjwkhejhjuiuiuisudiu"}}],"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"$ref":"#/components/schemas/AppConfigInfo"}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/record/fragment":{"get":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"查询用户积分有效期列表","description":"根据 account_id 查询积分有效期列表","parameters":[{"$ref":"#/components/parameters/accountIdPathParam"},{"$ref":"#/components/parameters/pageParam"},{"$ref":"#/components/parameters/pageSizeParam"}],"responses":{"200":{"description":"Successful. 以分页的方式返回用户积分有效期列表","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsFragmentRecordArray"},"extra":{"type":"object","properties":{"pagination":{"$ref":"#/components/schemas/Pagination"},"total_amount":{"type":"integer","description":"积分总计","example":6000}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/record/points":{"get":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"积分变动记录","description":"积分交易记录查询接口","parameters":[{"$ref":"#/components/parameters/pageParam"},{"$ref":"#/components/parameters/pageSizeParam"},{"$ref":"#/components/parameters/startTimeParam"},{"$ref":"#/components/parameters/endTimeParam"},{"name":"record_type","in":"query","description":"交易类型","schema":{"type":"string","enum":["expire 过期","transaction 交易","transact 转账","offer 发分","grant 授予","refund 退分","cancel_offer 取消发分"]}},{"name":"account_id","in":"query","description":"用户 ID","schema":{"type":"string","example":34343434324}},{"name":"id","in":"query","description":"内部流水号","schema":{"type":"integer","example":2323}},{"name":"raw_out_sn","in":"query","description":"外部流水号","schema":{"type":"string","example":"sdsds#sdsdsds"}},{"name":"role_type","in":"query","description":"账户的类型 merchant（商家账户）、operator（运营账户）或operable_merchant（可运营商家账户），member（普通账户）","schema":{"type":"string","example":"operator"}},{"name":"sort","in":"query","description":"排序,-created_at按创建时间倒序,created_at按创建时间升序,默认按创建时间倒序","schema":{"type":"string","enum":["-created_at","created_at"]}}],"responses":{"200":{"description":"Successful. 以分页的方式返回积分变更记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsRecordArray"},"extra":{"type":"object","properties":{"pagination":{"$ref":"#/components/schemas/Pagination"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/record/transaction":{"get":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"积分交易记录查询接口","description":"积分交易记录查询接口","parameters":[{"$ref":"#/components/parameters/pageParam"},{"$ref":"#/components/parameters/pageSizeParam"},{"$ref":"#/components/parameters/startTimeParam"},{"$ref":"#/components/parameters/endTimeParam"},{"name":"offer_entry_id","in":"query","description":"发放项id","schema":{"type":"integer","format":"int32"}},{"name":"source","in":"query","description":"渠道标识","schema":{"type":"string","format":"offer_policy"}},{"name":"sort","in":"query","description":"排序,-created_at按创建时间倒序,created_at按创建时间升序,默认按创建时间倒序","schema":{"type":"string","enum":["-created_at","created_at"]}}],"responses":{"200":{"description":"Successful. 以分页的方式返回记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"current_page":{"type":"integer"},"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":812212},"from_account_id":{"type":"integer","description":"交易发起方账户的 account_id","example":4294976823},"to_account_id":{"type":"integer","description":"交易目标方账户的 account_id","example":4294976823},"amount":{"type":"integer","description":"交易金额","example":8821},"transaction_type":{"$ref":"#/components/schemas/TransactionType"},"from_account_type":{"$ref":"#/components/schemas/AccountType"},"to_account_type":{"$ref":"#/components/schemas/AccountType"},"from_account_role_type":{"$ref":"#/components/schemas/AllRoleType"},"to_account_role_type":{"$ref":"#/components/schemas/AllRoleType"},"out_sn":{"$ref":"#/components/schemas/OutSn"},"remark":{"$ref":"#/components/schemas/Remark"},"source":{"$ref":"#/components/schemas/Source"},"created_at":{"$ref":"#/components/schemas/CreatedAt"},"updated_at":{"$ref":"#/components/schemas/UpdatedAt"},"to_account_record":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":1},"account_id":{"type":"integer","description":"记录ID","example":4294976823},"before_balance_amount":{"type":"integer","description":"变更前积分余额","example":20000},"amount":{"type":"integer","description":"变更积分数量","example":5000},"after_balance_amount":{"type":"integer","description":"变更后积分余额","example":15000}}},"from_account_record":{"type":"object","properties":{"id":{"type":"integer","description":"记录ID","example":1},"account_id":{"type":"integer","description":"记录ID","example":4294976823},"before_balance_amount":{"type":"integer","description":"变更前积分余额","example":20000},"amount":{"type":"integer","description":"变更积分数量","example":5000},"after_balance_amount":{"type":"integer","description":"变更后积分余额","example":15000}}}}}}}},"extra":{"type":"object","properties":{"pagination":{"$ref":"#/components/schemas/Pagination"},"total_amount":{"type":"integer","description":"积分总计","example":6000},"transaction_count":{"type":"integer","description":"总交易数量","example":1000}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/reverse_transaction/check":{"get":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"退积分检查接口","description":"退积分检查接口,包含取消发分检查和交易退分检查","parameters":[{"name":"transaction_out_sn","required":true,"in":"query","description":"外部交易号","schema":{"type":"string"}},{"name":"reverse_amount","required":true,"in":"query","description":"要退积分数量","schema":{"type":"integer","format":"int32"}},{"name":"reverse_type","in":"query","description":"要查询的原交易类型,默认是自动识别要查询的原交易类型","required":false,"schema":{"type":"string","enum":["offer","transact","auto"]}}],"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer","example":0},"message":{"type":"string","example":"success"},"data":{"type":"object","properties":{"can_reverse":{"description":"是否可退","type":"boolean","example":true},"can_reverse_amount":{"description":"可退积分数量","type":"integer","example":6000},"cannot_reverse_amount":{"description":"不可退积分数量","type":"integer","example":1000}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/freeze/cancel":{"post":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Backend","Public"],"summary":"冻结取消（*需登录）","description":"使用 out_sn 或 freeze_record_id 将交易时冻结的积分直接解冻，不完成积分交易。在交易失败或取消的情况下，需要调用此接口进行解冻。","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"freeze_record_id":{"type":"integer","description":"冻结记录id, 与 out_sn 二选一","example":12,"required":true},"out_sn":{"type":"string","description":"外部流水号, 与 freeze_record_id 二选一","example":129494,"required":true},"reason":{"type":"string","description":"取消原因","example":"订单付款超时","required":true}},"required":["reason"]}}}},"responses":{"200":{"description":"Successful.","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/FreezeRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/freeze/commit_transaction":{"post":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Backend","Public"],"summary":"冻结转交易（*需登录）","description":"使用 out_sn 或 freeze_record_id 将对应冻结的积分转为交易，即解冻积分并完成积分交易。","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"freeze_record_id":{"type":"integer","description":"冻结记录id, 与 out_sn 二选一","example":12,"required":true},"out_sn":{"type":"string","description":"外部流水号, 与 freeze_record_id 二选一","example":129494,"required":true}}}}}},"responses":{"200":{"description":"Successful. 返回冻结记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/FreezeRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"},"to_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/freeze/transacting":{"post":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Backend","Public"],"summary":"交易时冻结（*需登录）","description":"交易时冻结: 指在交易过程中，暂时将登录用户的一笔积分转为不可用状态。\n\n交易时冻结是一个中间状态，将用户的积分冻结后，会执行二个后续的操作之一：取消冻结或冻结转交易。\n\n（一期暂未实现）在长时间未调用取消或转交易的情况下，积分系统会以一定的间隔调用查询API以处理该笔冻结。查询API是调用方所提供的预定义API接口，并颁发调用方client_id的时候进行配置。\n\n另外，如果一定时间内查询API也未能有效调用，则会进行强制冻结取消。\n交易时冻结使用的场景: 积分和港币混合支付。支付时先将对应的积分冻结，待用户取消付款或付款完成是再解冻或将该笔冻结的积分转为交易。\n","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"to_account_id":{"type":"integer","description":"收分商家账户的 account_id","example":344485885854,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"amount":{"type":"float","description":"需要冻结的积分数量， 目前只支持没有小数点的 float 型","example":100,"required":true},"source":{"type":"string","description":"外部的交易类型","example":"order","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"order_id\": 129484448,\n  \"pay_time\": \"2018-08-12T15:19:21+08:00\",\n  \"qrcode-sn\": 339829983284,\n  \"money\": 220.00\n}","required":true}},"required":["to_account_id","out_sn","amount","source","remark"]}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/FreezeRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/transact":{"post":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Backend","Public"],"summary":"交易（*需登录）","description":"登录用户创建一笔交易。\n积分流向：从交易子账户 到 收分子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"to_account_id":{"type":"integer","description":"接收人账户的 account_id","example":1828437413,"required":true},"amount":{"type":"float","description":"交易金额，目前只支持没有小数点的 float 型","example":3004,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"eatjoy-qrcode-pay","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"order_id\": 129484448,\n  \"pay_time\": \"2018-08-12T15:19:21+08:00\",\n  \"qrcode-sn\": 339829983284,\n  \"money\": 220.00\n}","required":true},"push_notification":{"type":"integer","description":"是否发通知，1表示发通知 0不发通知，默认是1。","example":0}},"required":["to_account_id","amount","out_sn","source","remark"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/TransactionRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBalance"},"to_account":{"$ref":"#/components/schemas/PointsAccountBalance"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/transfer":{"post":{"servers":[{"url":"http://dist-sz.kpmember.cn/member-api-gateway-kit--租户Key/points/core/api/v1","description":"for Public"}],"tags":["Backend","Public"],"summary":"转账（*需登录）","description":"登录用户创建一笔转账。\n\n积分流向：从交易子账户 到 交易子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"to_account_id":{"type":"integer","description":"接收人账户的 account_id","example":1828437413,"required":true},"amount":{"type":"float","description":"交易金额，目前只支持没有小数点的 float 型","example":3004,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"hk01-qrcode","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"order_id\": 129484448,\n  \"transfer_time\": \"2018-08-12T15:19:21+08:00\",\n  \"qrcode-sn\": 33981231234\n}","required":true},"push_notification":{"type":"integer","description":"是否发通知，1表示发通知 0不发通知，默认是1。","example":0}},"required":["to_account_id","amount","out_sn","source","remark"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/TransactionRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBalance"},"to_account":{"$ref":"#/components/schemas/PointsAccountBalance"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/account/create_business_account":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"创建商家账户或运营账户","description":"创建一个业务积分账户，账号类型可以是merchant（商家账户）、operator（运营账户）或operable_merchant（可运营商家账户），member（普通账户）无需在这里创建。","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"account_id":{"type":"integer","description":"account_id，必填，可以为 0。当值为 0 的时候，系统会生成 account_id"},"username":{"type":"string","description":"用户名称，需要唯一，不能重复"},"status":{"$ref":"#/components/schemas/PointsAccountStatus"},"role_type":{"$ref":"#/components/schemas/PartnerRoleType"}},"required":["account_id","username","role_type"]}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"$ref":"#/components/schemas/PointsAccountInfo"},"extra":{"type":"object","properties":{}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/account/delete":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"删除未激活用户的账户","description":"根据 account_id 删除未激活用户\n","parameters":[{"$ref":"#/components/parameters/accountIdPathParam"}],"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"type":"string","example":""}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/account/search":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"系统全部账户的列表","description":"查询系统全部账户（积分余额）的列表\n","parameters":[{"$ref":"#/components/parameters/pageParam"},{"$ref":"#/components/parameters/pageSizeParam"},{"$ref":"#/components/parameters/roleTypeParam"},{"$ref":"#/components/parameters/sortParam"},{"name":"account_id","in":"query","description":"账户的 account_id，通过 account_id 搜索","required":false,"schema":{"type":"string"},"example":2773912304},{"name":"username","in":"query","description":"账户用户名（除普通会员外）,支持模糊搜索","required":false,"schema":{"type":"string"},"example":"test"},{"name":"status","in":"query","description":"账户状态\n* activation 激活　\n* not_activated 未启用　\n* freeze 冻结（能进不能出）","required":false,"schema":{"type":"string","enum":["activation","not_activated","freeze"]}}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"account_id_list":{"type":"array","description":"用户的 account_id 列表，当 account_id 参数没有值的时候此参数才生效","items":{"type":"integer"}}}}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsAccountBalanceList"},"extra":{"type":"object","properties":{"pagination":{"$ref":"#/components/schemas/Pagination"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/account/update":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"更新用户的账户信息","description":"根据 account_id 更新用户信息。\n","parameters":[{"$ref":"#/components/parameters/accountIdPathParam"}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"status":{"$ref":"#/components/schemas/PointsAccountUpdateStatus"},"username":{"type":"string","example":"张三"}}}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/PointsAccountInfo"},"extra":{"type":"object","properties":{}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/app/create":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"创建 App","description":"业务方可以调用此接口来创建 App\n","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppCreateDelete"}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"$ref":"#/components/schemas/AppInfo"}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/app/delete":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"删除 App","description":"业务方可以调用此接口来删除 App\n","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AppCreateDelete"}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"type":"string","example":""}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/app/set_config":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"第三方应用设置配置","description":"业务方可以调用此接口来注册或者更新对应查询接口地址或者配置。\n","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"app_key":{"description":"账号系统颁发的 appKey","required":true,"type":"string","example":"34343434324sjwkhejhjuiuiuisudiu"},"freeze":{"type":"string","example":{"action_query_api_url":"http://xxx/api/v1/transaction/status","action_query_after":86400,"timeout":604800,"app_secret":"3434ui3ohjekhjhjerioi"},"description":"参数说明:\n\n\n以下参数除了 app_secret 之外都为必填项，`action_query_api_url` 允许为空。\n\n* action_query_api_url：值为 URL 或者空类型；冻结结果主动查询 API URL ，一次冻结超过 action_query_after 时会使用此 URL 开始进行查询。此 API 的定义为 freeze_action_query_api。如果为空，则不会进行主动查询。默认为空。\n\n* action_query_after：值为 integer 类型；冻结结果主动查询开始时间，单位是秒，一次冻结超过此时间会使用 action_query_api_url 开始进行主动查询。默认为24小时。\n\n* timeout：值为 integer 类型；冻结超时时间，单位是秒，冻结超过此时间将会被强制取消。默认为7天。\n\n* app_secret：值为 string 类型；可选参数，如果设置了 app_secret 的值，请求 action_query_api_url 的时候，会用 app_key 和 app_secret 生成 JWT，添加到 Header 上","required":true},"default_language":{"type":"string","enum":["en","zh-Hans-CN","zh-Hant-HK"],"example":"zh-Hant-HK","description":"default_language：默认语言选线，当调用接口没有在 HTTP Header 中使用 `Content-Language` 时，返回的数据会使用到此参数作为语言，如果此参数也没有，则使用 `zh-Hant-CN`"},"transaction_title_template":{"type":"string","example":{"template_key":{"from":{"en":"display english transaction description","zh-Hans-CN":"展示积分明细描述, 使用简体中文","zh-Hant-HK":"展示積分明細描述, 使用繁體中文"}},"hk01.protobuf.wallet.payment.PaymentSuccess":{"from":{"en":"Payment success! You payed {amount} points to {target_nickname}","zh-Hans-CN":"交易成功, 你向 {target_nickname} 支付了 {amount} 个积分.","zh-Hant-HK":"交易成功, 你向 {target_nickname} 支付了 {amount} 個積分."},"to":{"en":"Payment success! You received {amount} points from {from_nickname}","zh-Hans-CN":"交易成功! 你从 {target_nickname} 获得 {amount} 个积分.","zh-Hant-HK":"交易成功! 你從 {target_nickname} 獲得 {amount} 個積分."}},"self_defined_template_key_1":{"from":{"en":"Thank you! You donate {amount} points for this campaign.","zh-Hans-CN":"感谢你, 你为这个活动捐赠了 {amount} 个积分.","zh-Hant-HK":"感謝你, 你為這個活動捐贈了 {amount} 個積分."}},"self_defined_template_key_2":{"to":{"en":"Congratulations! You earn {amount} points from this campaign.","zh-Hans-CN":"恭喜你! 参加活动获取了 {amount} 个积分.","zh-Hant-HK":"恭喜你! 參加活動獲取了 {amount} 個積分."}}},"description":"transaction_title_template： 为积分明细配置模板，详情使查看文档头部说明"}},"required":["freeze","api_key"]}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"$ref":"#/components/schemas/AppConfigInfo"}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/batch_offer":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"批量发放","description":"给多个 **普通用户** 发放积分。\n\n积分流向：从发放子账户　到　交易子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"from_account_id":{"type":"integer","description":"发放积分账户的 account_id","example":344485885854,"required":true},"threshold":{"type":"integer","description":"阈值。当账户积分余额低于阈值时，交易失败。","example":3384},"to_account_id_list":{"type":"array","description":"目标用户的 account_id","items":{"type":"integer"},"required":true},"amount":{"type":"float","description":"发放的积分数量，目前只支持没有小数点的 float 型","example":139494,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"mcp","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"manual_offer\": [\n    {\n      \"operator\": \"xx@hk01.com\",\n      \"reason\": \"so cool!\",\n    },\n    {\n      \"operator\": \"yy@hk01.com\",\n      \"reason\": \"just a little cool!\",\n    }\n  ]\n}","required":true},"push_notification":{"type":"integer","description":"是否发通知，1表示发通知 0不发通知，默认是1。","example":0},"expire_date":{"type":"string","description":"发放的积分过期日期，目前只支持精确到天，时区是 UTC+8。目前支持最大值是 2038-01-18","example":"2019-07-03","required":true}},"required":["from_account_id","to_account_id_list","amount","out_sn","remark","source","expired_date"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"total":{"type":"integer","description":"用户总数"},"offer_success":{"type":"integer","description":"发放成功的用户数"},"success_list":{"type":"array","items":{"$ref":"#/components/schemas/TransactionRecord"}},"offer_fail":{"type":"integer","description":"发放失败的用户数量"},"fail_list":{"type":"array","items":{"type":"object","properties":{"account_id":{"type":"integer","description":"account_id"},"reason":{"type":"string","description":"失败的原因"}}}}}},"extra":{"type":"object","example":{}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/freeze/cancel":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"冻结取消","description":"使用 out_sn 或 freeze_record_id 将交易时冻结的积分直接解冻，不完成积分交易。在交易失败或取消的情况下，需要调用此接口进行解冻。","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"freeze_record_id":{"type":"integer","description":"冻结记录id, 与 out_sn 二选一","example":12,"required":true},"out_sn":{"type":"string","description":"外部流水号, 与 freeze_record_id 二选一","example":129494,"required":true},"reason":{"type":"string","description":"取消原因","example":"订单付款超时","required":true}},"required":["reason"]}}}},"responses":{"200":{"description":"Successful.","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/FreezeRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/freeze/commit_transaction":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"冻结转交易","description":"使用 out_sn 或 freeze_record_id 将对应冻结的积分转为交易，即解冻积分并完成积分交易。","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"freeze_record_id":{"type":"integer","description":"冻结记录id, 与 out_sn 二选一","example":12,"required":true},"out_sn":{"type":"string","description":"外部流水号, 与 freeze_record_id 二选一","example":129494,"required":true}}}}}},"responses":{"200":{"description":"Successful. 返回冻结记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/FreezeRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"},"to_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/freeze/transacting":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"交易时冻结","description":"交易时冻结: 指在交易过程中，暂时将用户的一笔积分转为不可用状态。\n\n交易时冻结是一个中间状态，将用户的积分冻结后，会执行二个后续的操作之一：取消冻结或冻结转交易。\n\n（一期暂未实现）在长时间未调用取消或转交易的情况下，积分系统会以一定的间隔调用查询API以处理该笔冻结。查询API是调用方所提供的预定义API接口，并颁发调用方client_id的时候进行配置。\n\n另外，如果一定时间内查询API也未能有效调用，则会进行强制冻结取消。\n交易时冻结使用的场景: 积分和港币混合支付。支付时先将对应的积分冻结，待用户取消付款或付款完成是再解冻或将该笔冻结的积分转为交易。\n","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"from_account_id":{"type":"integer","description":"发放积分账户的 account_id","example":1828437413,"required":true},"to_account_id":{"type":"integer","description":"收分商家账户的 account_id","example":344485885854,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"amount":{"type":"float","description":"需要冻结的积分数量， 目前只支持没有小数点的 float 型","example":100,"required":true},"source":{"type":"string","description":"外部的交易类型","example":"order","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"order_id\": 129484448,\n  \"pay_time\": \"2018-08-12T15:19:21+08:00\",\n  \"qrcode-sn\": 339829983284,\n  \"money\": 220.00\n}","required":true}},"required":["from_account_id","to_account_id","out_sn","amount","source","remark"]}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/FreezeRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/grant":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"授予积分","description":"给**运营账户**或**可运营商家账户**发放一笔积分。\n\n积分流向：从系统账户　到　发放子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"to_account_id":{"type":"integer","description":"接收人账户的 account_id","required":true},"amount":{"type":"float","description":"授予的积分数量，目前只支持没有小数点的 float 型","required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"mcp","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"grant_id\": 123123,\n  \"grant_reason\": \"for event.\"\n}","required":true}},"required":["to_account_id","amount","out_sn","source","remark"]}}}},"responses":{"200":{"description":"Successful. 返回授予记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/GrantRecord"},"extra":{"type":"object","properties":{"balance_amount":{"type":"integer","description":"发放子账户的积分余额"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/offer":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"发放","description":"给 **普通用户** 发放积分。\n\n积分流向：从发放子账户　到　交易子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"from_account_id":{"type":"integer","description":"发放积分账户的 account_id","example":344485885854,"required":true},"to_account_id":{"type":"integer","description":"接收人账户的 account_id","example":187664023444,"required":true},"threshold":{"type":"integer","description":"发放积分账户余额阈值。当发放账户积分余额低于阈值时，交易失败。","example":3384},"amount":{"type":"float","description":"发放的积分数量，目前只支持没有小数点的 float 型","example":139494,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"policy-offer","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"offer_entry_id\":123,\n  \"offer_rule_matched\":[\n    {\n      \"offer_rule_id\":321,\n      \"offer_rule_detail\":[\n        {\n          \"event_key\":\"GamePlayCompleted\",\n          \"event_condition\":\"score_in_game:0-200\",\n          \"trigger_num\":3,\n          \"happened_num\":5,\n          \"changed\":true\n        },\n        {\n          \"event_key\":\"GamePlayCompleted\",\n          \"event_condition\":\"score_in_game:201-300\",\n          \"trigger_num\":5,\n          \"happened_num\":1,\n          \"changed\":false\n        }\n      ]\n    }\n  ]\n}","required":true},"push_notification":{"type":"integer","description":"是否发通知，1表示发通知 0不发通知，默认是1。","example":0},"triggered_event_key":{"type":"string","description":"目前只针对积分引擎传过来才有此参数，指最终触发本次发放的事件key值","example":"hk01.protobuf.game.mcgame.GameCompleted"},"triggered_event_publisher_info":{"type":"string","description":"\n目前只针对积分引擎传过来才有此参数，指最终触发本次发放的事件（触发事件）发送者自定义的信息，此数据可以用来精准识别触发事件。 其来源于触发事件中可选的特定事件参数 publisher_info，可能为空。如果需要用此参数，则触发事件的发送者需注意：\n1. 必须在自己的事件定义中以 publisher_info 为名称定义事件参数；\n2. publisher_info 参数必须在事件的 message body 顶层；\n3. publisher_info 参数必须为string类型；\n4. 在发送事件时填充自己可识别的值到 publisher_info ，例如uuid或订单号。","example":"POINT-1904282077970793"},"expire_date":{"type":"string","description":"发放的积分过期日期，目前只支持精确到天，时区是 UTC+8。目前支持最大值是 2038-01-18","example":"2019-07-03","required":true}},"required":["from_account_id","to_account_id","amount","out_sn","source","remark","expired_date"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer","example":0},"message":{"type":"string","example":"success"},"data":{"$ref":"#/components/schemas/TransactionRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBase"},"to_account":{"$ref":"#/components/schemas/PointsAccountBase"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/reverse_transaction/cancel_offer":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"取消发分","description":"针对发积分操作的反向操作,取消发分 积分流向：从交易子账户　到　发放子账户 业务调用方只能取消自己发的分,会根据 app_key 来做校验 如果用户的积分不足,则不能进行取消加分","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"transaction_out_sn":{"type":"string","description":"原交易时的外部流水号","example":3939948484,"required":true},"reverse_transaction_sn":{"type":"string","description":"这次退分的交易号,因为是跨系统调用,退分又要求支持多次退分,所以需要用一个唯一的业务流水号来做幂等处理","example":39399484841,"required":true},"source":{"type":"string","description":"来源","example":"policy","required":true},"reverse_amount":{"type":"integer","description":"要退多少分","example":1000,"required":true},"remark":{"type":"string","description":"外部备注信息，json格式","example":"{  \"message\":\"七天无理由退款\"\n}","required":true}},"required":["transaction_out_sn","reverse_transaction_sn","reverse_amount","source","remark"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer","example":0},"message":{"type":"string","example":"success"},"data":{"type":"object","properties":{"reverse_amount":{"type":"integer","description":"退回的积分总额","example":1000},"expired_amount":{"type":"integer","description":"过期的积分","example":1000}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/reverse_transaction/refund":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"交易退分","description":"针对交易的反向操作,退积分 积分流向：从收分子账户　到　交易子账户 业务调用方只能取消自己的交易单,会根据 app_key 来做校验","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"transaction_out_sn":{"type":"string","description":"原交易时的外部流水号","example":3939948484,"required":true},"reverse_transaction_sn":{"type":"string","description":"这次退分的交易号,因为是跨系统调用,退分又要求支持多次退分,所以需要用一个唯一的业务流水号来做幂等处理","example":39399484841,"required":true},"source":{"type":"string","description":"来源","example":"policy","required":true},"reverse_amount":{"type":"integer","description":"要退多少分","example":1000,"required":true},"remark":{"type":"string","description":"外部备注信息，json格式","example":"{  \"message\":\"七天无理由退款\"\n}","required":true}},"required":["transaction_out_sn","reverse_transaction_sn","source","reverse_amount","remark"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer","example":0},"message":{"type":"string","example":"success"},"data":{"type":"object","properties":{"reverse_amount":{"type":"integer","description":"退回的积分总额","example":1000}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/setting/initialize":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"系统初始化数据","description":"系统初始化配置信息\n","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Setting"}}}},"responses":{"200":{"description":"Successful","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string","example":"success"},"data":{"$ref":"#/components/schemas/Setting"}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/transact":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"交易","description":"用户创建一笔交易。\n积分流向：从交易子账户 到 收分子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"from_account_id":{"type":"integer","description":"发放积分账户的 account_id","example":1828437413,"required":true},"to_account_id":{"type":"integer","description":"接收人账户的 account_id","example":1828437413,"required":true},"amount":{"type":"float","description":"交易金额，目前只支持没有小数点的 float 型","example":3004,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"eatjoy-qrcode-pay","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"order_id\": 129484448,\n  \"pay_time\": \"2018-08-12T15:19:21+08:00\",\n  \"qrcode-sn\": 339829983284,\n  \"money\": 220.00\n}","required":true},"push_notification":{"type":"integer","description":"是否发通知，1表示发通知 0不发通知，默认是1。","example":0}},"required":["from_account_id","to_account_id","amount","out_sn","source","remark"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/TransactionRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBalance"},"to_account":{"$ref":"#/components/schemas/PointsAccountBalance"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}},"/internal/transfer":{"post":{"security":[{"bearerAuth":[]}],"tags":["Internal"],"summary":"转账","description":"用户创建一笔转账。\n积分流向：从交易子账户 到 交易子账户","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"from_account_id":{"type":"integer","description":"发放积分账户的 account_id","example":1828437413,"required":true},"to_account_id":{"type":"integer","description":"接收人账户的 account_id","example":1828437413,"required":true},"amount":{"type":"float","description":"交易金额，目前只支持没有小数点的 float 型","example":3004,"required":true},"out_sn":{"type":"string","description":"外部流水号","example":3939948484,"required":true},"source":{"type":"string","description":"外部来源","example":"hk01-qrcode","required":true},"remark":{"type":"string","description":"外部备注信息，可以是json格式。其格式具体定义由source确定。","example":"{  \"order_id\": 129484448,\n  \"transfer_time\": \"2018-08-12T15:19:21+08:00\",\n  \"qrcode-sn\": 33981231234\n}","required":true},"push_notification":{"type":"integer","description":"是否发通知，1表示发通知 0不发通知，默认是1。","example":0}},"required":["from_account_id","to_account_id","amount","out_sn","source","remark"]}}}},"responses":{"200":{"description":"Successful. 返回交易记录","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"$ref":"#/components/schemas/TransactionRecord"},"extra":{"type":"object","properties":{"from_account":{"$ref":"#/components/schemas/PointsAccountBalance"},"to_account":{"$ref":"#/components/schemas/PointsAccountBalance"}}}}}}}},"401":{"$ref":"#/components/responses/Standard401ErrorResponse"},"4XX":{"$ref":"#/components/responses/Standard4XXErrorResponse"}}}}}}